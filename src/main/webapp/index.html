<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

</head>
<body>
<h1>System Health</h1>
<div id="result"></div>
<script>
$(document).ready(function(){
	var url = 'ws://localhost:8080/systemhealthweb/shwebsocket'	
	var ws = new WebSocket(url);
	ws.onconnect = function(e) {
	  console.log("connected");
	}
	ws.onerror = function (error) {
	  console.log('WebSocket Error ' + error);
	};
	ws.onclose = function(event){
	     console.log("Remote host closed or refused WebSocket connection");
	     console.log(event);
	};
	ws.onmessage = function(message) {
	
		translate(message.data);
	};
});

/**
 * Render JSON response as HTML
 */
function translate(response){
	var statArray = JSON.parse(response);
	var i, j;
	var out = " ";

	for(i = 0; i < statArray.length; i++){
		
	    out += "<h2>" + statArray[i].serverName + "</h2><br/><p>";
	    out += "Percent CPU Usage (%) = " + statArray[i].percentCPUUsage + "<br/>";
	    out += "Server up time (days) = " + statArray[i].serverUpTimeDays + "<br/>";
	    out += "Percent memory free (%) = " + statArray[i].percentMemFree + "<br/>";

	    //loop thru each disk (hard drive)
	    if(statArray[i].disks.length > 0) {
		    out += "<table><tr><th>Device ID</th><th>Total Size(KB)</th><th>Free Disk Space(KB)</th><th>Percent Disk Free (%)</th></tr>";
		    
		    for(j = 0; j < statArray[i].disks.length; j++){
		    	  out += "<tr> <td>" + statArray[i].disks[j].deviceID + "</td>";
		    	  out += "<td>" + statArray[i].disks[j].totalSizeKB + "</td>";
		    	  out += "<td>" + statArray[i].disks[j].freeSizeKB + "</td>";
		    	  out += "<td>" + statArray[i].disks[j].percentDiskFree + "</td></tr>";
			}
		    out += "</table>";
	    }

	    out += "<br/><br/></p>";
	}
	document.getElementById("result").innerHTML = out;
	
}
</script>
</body>
</html>
